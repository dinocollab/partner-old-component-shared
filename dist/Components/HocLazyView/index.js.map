{"version":3,"file":"index.js","sources":["../../../src/Components/HocLazyView/index.tsx"],"sourcesContent":["import React, { Component, ComponentType } from 'react'\r\nimport { LazyStatus } from '../Redux/core/type';\r\nimport { LazyView } from '../SubComponent';\r\n\r\ninterface IHocComponentState<TData = any> {\r\n    status: LazyStatus\r\n    data: TData | null\r\n}\r\ninterface IHocComponentProps<TActionParam = any> {\r\n    params?: TActionParam;\r\n}\r\ninterface OptionsHocLazy<TActionParam = any, TData = any> {\r\n    params?: TActionParam;\r\n    FetchData: (params?: TActionParam, signal?: AbortSignal) => Promise<TData>\r\n}\r\nexport interface IHocLazyViewWrappedProps<TActionParam = any, TData = any> {\r\n    data: any | null\r\n    FetchData: (params?: TActionParam, signal?: AbortController) => Promise<TData>\r\n    SetData: (data: TData) => void\r\n}\r\nconst HocLazyView = (options: OptionsHocLazy) => (WrappedComponent: ComponentType<IHocLazyViewWrappedProps>) => {\r\n\r\n    class hocComponent extends Component<IHocComponentProps, IHocComponentState> {\r\n        constructor(props: IHocComponentProps) {\r\n            super(props)\r\n            this.state = {\r\n                status: LazyStatus.Loading,\r\n                data: null\r\n            }\r\n            this.FetchData = this.FetchData.bind(this)\r\n        }\r\n        SwitchView = (status: LazyStatus) => {\r\n            switch (status) {\r\n                case LazyStatus.Loading:\r\n                case LazyStatus.Loaded:\r\n                    return (\r\n                        <LazyView IsLazy={status === LazyStatus.Loading} sx={{\r\n                            flex: 1, display: 'flex', flexDirection: 'column',\r\n                        }}>\r\n                            <WrappedComponent\r\n                                {...this.props} data={this.state.data}\r\n                                FetchData={this.FetchData}\r\n                                SetData={this.SetData}\r\n                            />\r\n                        </LazyView>\r\n                    )\r\n                default:\r\n                    return <div>Error...</div>;\r\n            }\r\n        }\r\n        SetData = (data: any) => {\r\n            this.setState({\r\n                data\r\n            })\r\n        }\r\n        componentDidMount = async () => {\r\n            const param = Object.assign(\r\n                {},\r\n                options?.params ?? {},\r\n                this.props.params ?? {},\r\n            );\r\n            this.TokenSources = new AbortController()\r\n            await this.FetchData(param)\r\n        };\r\n        FetchData = async (params: any, controller?: AbortController) => {\r\n            try {\r\n                controller?.abort && this.TokenSources?.signal.addEventListener(\"abort\", controller?.abort)\r\n                const signal = controller ? controller.signal : this.TokenSources?.signal\r\n                const data = await options.FetchData(params, signal)\r\n                this.setState({\r\n                    status: LazyStatus.Loaded,\r\n                    data\r\n                })\r\n            } catch {\r\n                this.setState({\r\n                    status: LazyStatus.Error,\r\n                })\r\n            } finally {\r\n                controller?.abort && this.TokenSources?.signal.removeEventListener(\"abort\", controller?.abort)\r\n            }\r\n        }\r\n        TokenSources?: AbortController\r\n        componentWillUnmount() {\r\n            console.log(\"componentWillUnmount\")\r\n            this.TokenSources?.abort()\r\n        }\r\n        public render() {\r\n            return this.SwitchView(this.state.status)\r\n        }\r\n    }\r\n    return hocComponent\r\n}\r\nexport default HocLazyView"],"names":["HocLazyView","options","WrappedComponent","hocComponent","_Component","props","_this","_classCallCheck","_callSuper","_defineProperty","status","LazyStatus","Loading","Loaded","_jsx","LazyView","IsLazy","sx","flex","display","flexDirection","children","_objectSpread","data","state","FetchData","SetData","setState","_asyncToGenerator","_regenerator","m","_callee","_options$params","_this$props$params","param","w","_context","n","Object","assign","params","TokenSources","AbortController","a","_ref2","_callee2","controller","_this$TokenSources","_this$TokenSources2","signal","_this$TokenSources3","_context2","p","abort","addEventListener","v","Error","removeEventListener","f","_x","_x2","apply","arguments","bind","_inherits","_createClass","key","value","componentWillUnmount","_this$TokenSources4","console","log","render","SwitchView","Component"],"mappings":"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"}