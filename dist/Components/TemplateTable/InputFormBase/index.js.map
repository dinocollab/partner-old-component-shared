{"version":3,"file":"index.js","sources":["../../../../src/Components/TemplateTable/InputFormBase/index.tsx"],"sourcesContent":["import { FormValidator, PartialError } from 'partner-local-lib/helper'\r\nimport React, { Component, FormEvent, createContext } from 'react'\r\nimport { ConvertFormDataToJson, GetErrorFromResponse, SingleValidate } from '../../Helper'\r\ninterface InputFormBaseProps<TModel> {\r\n  FormValidate: FormValidator<Partial<TModel>>\r\n  onSubmit: (user: Partial<TModel>) => Promise<void>\r\n}\r\ninterface InputFormBaseState<TModel> {\r\n  MessageError: PartialError<TModel>\r\n  modelState?: Partial<TModel>\r\n  onBlur: (keyName: string) => void\r\n}\r\n\r\nexport const InputFormContext = createContext<InputFormBaseState<any>>({\r\n  onBlur: () => {},\r\n  MessageError: {},\r\n})\r\nexport default class InputFormBase<TModel = any> extends Component<InputFormBaseProps<TModel>, InputFormBaseState<TModel>> {\r\n  constructor(props: InputFormBaseProps<TModel>) {\r\n    super(props)\r\n    this._formValidate = props.FormValidate\r\n    this.state = {\r\n      onBlur: this.onBlur,\r\n      MessageError: {},\r\n    }\r\n    this._form = React.createRef<HTMLFormElement>()\r\n  }\r\n  _formValidate: FormValidator<Partial<TModel>>\r\n  onSubmit: React.FormEventHandler<HTMLFormElement> = async (e) => {\r\n    e.preventDefault()\r\n    const { MessageError } = this.state\r\n    const formData = new FormData(e.target as HTMLFormElement)\r\n    const model = ConvertFormDataToJson<TModel>(formData)\r\n\r\n    this.setState({ modelState: model })\r\n    const messageErrors = this._formValidate.run(model)\r\n    if (messageErrors) {\r\n      this.setState({ MessageError: messageErrors as PartialError<TModel> })\r\n      if (Object.keys(messageErrors).length > 0) return\r\n    }\r\n\r\n    await this.props.onSubmit(model).catch((error) => {\r\n      const messageError = GetErrorFromResponse(error, model)\r\n      this.setState({ MessageError: { ...MessageError, ...(messageError || {}) } })\r\n    })\r\n  }\r\n  onBlur = (keyName: string) => {\r\n    // console.log({ keyName })\r\n    if (!this._form.current) return\r\n    const { MessageError } = this.state\r\n    const formData = new FormData(this._form.current)\r\n    const model = ConvertFormDataToJson(formData)\r\n\r\n    this.setState({ modelState: model })\r\n    const error = SingleValidate<TModel, Partial<TModel>>(keyName, model, MessageError, this._formValidate) || {}\r\n    this.setState({ MessageError: error as PartialError<TModel> })\r\n  }\r\n  cleanErrorMessage = () => {\r\n    this.setState({ MessageError: {} })\r\n  }\r\n  cleanErrorMessageByKey = (params: string) => {\r\n    let obj = { ...this.state.MessageError }\r\n    if (params in obj) delete obj[params]\r\n    this.setState({ MessageError: obj })\r\n  }\r\n  _form: React.RefObject<HTMLFormElement>\r\n  render() {\r\n    return (\r\n      <form ref={this._form} onSubmit={this.onSubmit}>\r\n        <InputFormContext.Provider value={this.state}>{this.props.children}</InputFormContext.Provider>\r\n      </form>\r\n    )\r\n  }\r\n}\r\n"],"names":["InputFormContext","createContext","onBlur","MessageError","InputFormBase","_Component","props","_this","_classCallCheck","_callSuper","_defineProperty","_ref","_asyncToGenerator","_regenerator","m","_callee","e","formData","model","messageErrors","w","_context","n","preventDefault","state","FormData","target","ConvertFormDataToJson","setState","modelState","_formValidate","run","Object","keys","length","a","onSubmit","error","messageError","GetErrorFromResponse","_objectSpread","_x","apply","arguments","keyName","_form","current","SingleValidate","params","obj","FormValidate","React","createRef","_inherits","_createClass","key","value","render","_jsx","ref","Provider","children","Component"],"mappings":"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"}