{"version":3,"file":"DropzoneDialog.js","sources":["../../../../src/Components/DropZone/components/DropzoneDialog.jsx"],"sourcesContent":["import PropTypes from \"prop-types\";\r\nimport * as React from \"react\";\r\n\r\nimport { createFileFromUrl, readFile } from \"../helpers\";\r\n\r\nimport DropzoneDialogBase from \"./DropzoneDialogBase\";\r\n\r\n/**\r\n * This component provides an uncontrolled version of the DropzoneDialogBase component.\r\n *\r\n * It supports all the Props and Methods from `DropzoneDialogBase` but keeps the files state internally.\r\n *\r\n * **Note** The `onSave` handler also returns `File[]` with all the accepted files.\r\n */\r\nclass DropzoneDialog extends React.PureComponent {\r\n  state = {\r\n    fileObjects: [],\r\n  };\r\n\r\n  componentDidMount() {\r\n    this.loadInitialFiles();\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    const { clearOnUnmount } = this.props;\r\n\r\n    if (clearOnUnmount) {\r\n      this.setState(\r\n        {\r\n          fileObjects: [],\r\n        },\r\n        this.notifyFileChange\r\n      );\r\n    }\r\n  }\r\n\r\n  notifyFileChange = () => {\r\n    const { onChange } = this.props;\r\n    const { fileObjects } = this.state;\r\n\r\n    if (onChange) {\r\n      onChange(fileObjects.map((fileObject) => fileObject.file));\r\n    }\r\n  };\r\n\r\n  loadInitialFiles = async () => {\r\n    const { initialFiles } = this.props;\r\n    try {\r\n      const fileObjs = await Promise.all(\r\n        initialFiles.map(async (initialFile) => {\r\n          let file;\r\n          if (typeof initialFile === \"string\") {\r\n            file = await createFileFromUrl(initialFile);\r\n          } else {\r\n            file = initialFile;\r\n          }\r\n          const data = await readFile(file);\r\n\r\n          return {\r\n            file,\r\n            data,\r\n          };\r\n        })\r\n      );\r\n\r\n      this.setState(\r\n        (state) => ({\r\n          fileObjects: [].concat(state.fileObjects, fileObjs),\r\n        }),\r\n        this.notifyFileChange\r\n      );\r\n    } catch (err) {\r\n      console.log(err);\r\n    }\r\n  };\r\n\r\n  addFiles = async (newFileObjects) => {\r\n    const { filesLimit } = this.props;\r\n    // Update component state\r\n    this.setState((state) => {\r\n      // Handle a single file\r\n      if (filesLimit <= 1) {\r\n        return {\r\n          fileObjects: [].concat(newFileObjects[0]),\r\n        };\r\n      }\r\n\r\n      // Handle multiple files\r\n      return {\r\n        fileObjects: [].concat(state.fileObjects, newFileObjects),\r\n      };\r\n    }, this.notifyFileChange);\r\n  };\r\n\r\n  deleteFile = (removedFileObj, removedFileObjIdx) => {\r\n    global.event.stopPropagation();\r\n\r\n    const { onDelete } = this.props;\r\n    const { fileObjects } = this.state;\r\n\r\n    // Calculate remaining fileObjects array\r\n    const remainingFileObjs = fileObjects.filter((fileObject, i) => {\r\n      return i !== removedFileObjIdx;\r\n    });\r\n\r\n    // Notify removed file\r\n    if (onDelete) {\r\n      onDelete(removedFileObj.file);\r\n    }\r\n\r\n    // Update local state\r\n    this.setState(\r\n      {\r\n        fileObjects: remainingFileObjs,\r\n      },\r\n      this.notifyFileChange\r\n    );\r\n  };\r\n\r\n  handleClose = (evt) => {\r\n    const { clearOnUnmount, onClose } = this.props;\r\n\r\n    if (onClose) {\r\n      onClose(evt);\r\n    }\r\n\r\n    if (clearOnUnmount) {\r\n      this.setState(\r\n        {\r\n          fileObjects: [],\r\n        },\r\n        this.notifyFileChange\r\n      );\r\n    }\r\n  };\r\n\r\n  handleSave = (evt) => {\r\n    const { clearOnUnmount, onSave } = this.props;\r\n    const { fileObjects } = this.state;\r\n\r\n    if (onSave) {\r\n      onSave(\r\n        fileObjects.map((fileObject) => fileObject.file),\r\n        evt\r\n      );\r\n    }\r\n\r\n    if (clearOnUnmount) {\r\n      this.setState(\r\n        {\r\n          fileObjects: [],\r\n        },\r\n        this.notifyFileChange\r\n      );\r\n    }\r\n  };\r\n\r\n  render() {\r\n    const { fileObjects } = this.state;\r\n\r\n    return (\r\n      <DropzoneDialogBase\r\n        {...this.props}\r\n        fileObjects={fileObjects}\r\n        onAdd={this.addFiles}\r\n        onDelete={this.deleteFile}\r\n        onClose={this.handleClose}\r\n        onSave={this.handleSave}\r\n      />\r\n    );\r\n  }\r\n}\r\n\r\nDropzoneDialog.defaultProps = {\r\n  clearOnUnmount: true,\r\n  filesLimit: 3,\r\n  initialFiles: [],\r\n};\r\n\r\nDropzoneDialog.propTypes = {\r\n  ...DropzoneDialogBase.propTypes,\r\n  /** Clear uploaded files when component is unmounted. */\r\n  clearOnUnmount: PropTypes.bool,\r\n  /** Maximum number of files that can be loaded into the dropzone. */\r\n  filesLimit: PropTypes.number,\r\n  /** List containing File objects or URL strings.<br/>\r\n   * **Note:** Please take care of CORS.\r\n   */\r\n  initialFiles: PropTypes.arrayOf(\r\n    PropTypes.oneOfType([PropTypes.string, PropTypes.any])\r\n  ),\r\n  /**\r\n   * Fired when the user clicks the Submit button.\r\n   *\r\n   * @param {File[]} files All the files currently inside the Dropzone.\r\n   * @param {SyntheticEvent} event The react `SyntheticEvent`.\r\n   */\r\n  onSave: PropTypes.func,\r\n};\r\n\r\nexport default DropzoneDialog;\r\n"],"names":["DropzoneDialog","_React$PureComponent","_this","_classCallCheck","_len","arguments","length","args","Array","_key","_callSuper","concat","_defineProperty","fileObjects","onChange","props","state","map","fileObject","file","_asyncToGenerator","_regenerator","m","_callee2","initialFiles","fileObjs","_t","w","_context2","n","p","Promise","all","_ref2","_callee","initialFile","data","_context","createFileFromUrl","v","readFile","a","_x","apply","setState","notifyFileChange","console","log","_ref3","_callee3","newFileObjects","filesLimit","_context3","_x2","removedFileObj","removedFileObjIdx","global","event","stopPropagation","onDelete","remainingFileObjs","filter","i","evt","_this$props","clearOnUnmount","onClose","_this$props2","onSave","_inherits","_createClass","key","value","componentDidMount","loadInitialFiles","componentWillUnmount","render","_jsx","DropzoneDialogBase","_objectSpread","onAdd","addFiles","deleteFile","handleClose","handleSave","React","PureComponent","defaultProps","propTypes","PropTypes","bool","number","arrayOf","oneOfType","string","any","func"],"mappings":"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"}